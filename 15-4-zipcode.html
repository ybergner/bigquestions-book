<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="15.4 Zipcode tabulation area | Carpe Datum" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="ybergner/carpe-datum" />

<meta name="author" content="Yoav Bergner" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="15.4 Zipcode tabulation area | Carpe Datum">

<title>15.4 Zipcode tabulation area | Carpe Datum</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#preface">Preface</a><ul>
<li><a href="caveat.html#caveat">Caveat</a></li>
<li class="has-sub"><a href="guiding-principles-in-this-book.html#guiding-principles-in-this-book">Guiding principles in this book</a><ul>
<li><a href="guiding-principles-in-this-book.html#question-driven">Question-driven</a></li>
<li><a href="guiding-principles-in-this-book.html#no-proofs">No proofs</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="how-many-kinds-of-people-are-there.html#how-many-kinds-of-people-are-there">How Many Kinds of People Are There?</a><ul>
<li><a href="things-are-about-to-get-meta-right-from-the-start.html#things-are-about-to-get-meta-right-from-the-start">Things are about to get meta right from the start</a></li>
</ul></li>
<li class="has-sub"><a href="1-categories.html#categories"><span class="toc-section-number">1</span> Categories, counts, and kinds</a><ul>
<li><a href="1-categories.html#two-kinds-of-people">Two Kinds of People</a></li>
<li><a href="1-categories.html#samples-and-populations-a-statistical-caveat">Samples and Populations: A Statistical Caveat</a></li>
<li><a href="1-categories.html#a-psychological-caveat">A Psychological Caveat</a></li>
<li><a href="1-categories.html#summarizing-data">Summarizing data</a></li>
<li><a href="1-categories.html#checkpoint">Checkpoint</a></li>
</ul></li>
<li class="has-sub"><a href="2-dimensions.html#dimensions"><span class="toc-section-number">2</span> Dimensions</a><ul>
<li><a href="independence-association-and-contingency.html#independence-association-and-contingency">Independence, Association, and Contingency</a></li>
<li><a href="latent-factors-and-measurement.html#latent-factors-and-measurement">Latent Factors and Measurement</a></li>
</ul></li>
<li class="has-sub"><a href="3-test-indep.html#test-indep"><span class="toc-section-number">3</span> Tests of independence: A first look starring alternate universes</a><ul>
<li><a href="rise-of-the-machines.html#rise-of-the-machines">Rise of the machines</a></li>
<li><a href="hypothesis-testing-just-happened.html#hypothesis-testing-just-happened">Hypothesis testing just happened</a></li>
<li><a href="caveats.html#caveats">Caveats</a></li>
<li class="has-sub"><a href="sampling-simulations-and-randomness.html#sampling-simulations-and-randomness">Sampling, simulations, and randomness</a><ul>
<li><a href="sampling-simulations-and-randomness.html#tossing-virtual-coins">Tossing (virtual) coins</a></li>
<li><a href="sampling-simulations-and-randomness.html#but-some-observations-do-occur-more-than-others">But some observations <em>do</em> occur more than others</a></li>
</ul></li>
<li><a href="recap.html#recap">Recap</a></li>
</ul></li>
<li class="has-sub"><a href="4-shades.html#shades"><span class="toc-section-number">4</span> (An Infinite Number of) Shades of Gray (or Brown)</a><ul>
<li class="has-sub"><a href="poopiness.html#poopiness">Poopiness</a><ul>
<li><a href="poopiness.html#mixtures">Mixtures</a></li>
</ul></li>
<li class="has-sub"><a href="crappiness.html#crappiness">Crappiness</a><ul>
<li><a href="crappiness.html#check-your-understanding">Check your understanding</a></li>
</ul></li>
</ul></li>
<li><a href="5-cut-scores-and-abnormality.html#cut-scores-and-abnormality"><span class="toc-section-number">5</span> Cut Scores and Abnormality</a></li>
<li class="has-sub"><a href="6-the-modal-american.html#the-modal-american"><span class="toc-section-number">6</span> The Modal American</a><ul>
<li><a href="6-the-modal-american.html#step-one-categories">Step one: categories</a></li>
<li><a href="6-the-modal-american.html#step-two-contingency-table">Step two: contingency table</a></li>
<li><a href="6-the-modal-american.html#exercises">Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="7-sixteen-personalities-or-five-factors.html#sixteen-personalities-or-five-factors"><span class="toc-section-number">7</span> Sixteen Personalities or Five Factors?</a><ul>
<li><a href="7-sixteen-personalities-or-five-factors.html#mbti">MBTI</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#big-five">Big Five</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#twenty-questions-about-extraversion">Twenty Questions (about Extraversion)</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#but-whats-the-point">But what’s the point?</a></li>
<li><a href="still-meta-after-all-these-pages.html#still-meta-after-all-these-pages">Still meta after all these pages</a></li>
</ul></li>
<li class="has-sub"><a href="8-when-and-how-will-you-die.html#when-and-how-will-you-die"><span class="toc-section-number">8</span> When and How Will You Die?</a><ul>
<li class="has-sub"><a href="not-quite-death-but-um-rain.html#not-quite-death-but-um-rain">Not Quite Death, but, um… Rain?</a><ul>
<li><a href="not-quite-death-but-um-rain.html#stochastic-vs-deterministic-relationships">Stochastic vs Deterministic relationships</a></li>
</ul></li>
<li class="has-sub"><a href="ways-of-thinking-about-probabilistic-statements.html#ways-of-thinking-about-probabilistic-statements">Ways of thinking about probabilistic statements</a><ul>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#ensembles">Ensembles</a></li>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#degree-of-belief">Degree of belief</a></li>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#decisions">Decisions</a></li>
</ul></li>
<li><a href="death.html#death">Death</a></li>
</ul></li>
<li class="has-sub"><a href="9-conditional-death.html#conditional-death"><span class="toc-section-number">9</span> Conditional Death</a><ul>
<li><a href="9-conditional-death.html#how-does-the-death-simulation-work">How does the death (simulation) work?</a></li>
</ul></li>
<li class="has-sub"><a href="10-somefacts.html#somefacts"><span class="toc-section-number">10</span> Some facts about Probabilities</a><ul>
<li><a href="conditional-probabilities.html#conditional-probabilities">Conditional Probabilities</a></li>
<li class="has-sub"><a href="conditional-death-again.html#conditional-death-again">Conditional death, again</a><ul>
<li><a href="conditional-death-again.html#just-to-make-things-weird">Just to make things weird</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="11-how-you-will-die-causes-or-conditions.html#how-you-will-die-causes-or-conditions"><span class="toc-section-number">11</span> How You Will Die: Causes or Conditions?</a><ul>
<li><a href="causes-of-death-colloquially.html#causes-of-death-colloquially">Causes of death, colloquially</a></li>
<li><a href="hold-my-beer.html#hold-my-beer">Hold my beer</a></li>
<li><a href="non-deterministic-causation.html#non-deterministic-causation">Non-deterministic Causation</a></li>
<li><a href="testing-for-an-association-between-two-variables.html#testing-for-an-association-between-two-variables">Testing for an association between two variables</a></li>
</ul></li>
<li class="has-sub"><a href="will-you-make-money.html#will-you-make-money">Will You Make Money?</a><ul>
<li><a href="battle-of-the-bills.html#battle-of-the-bills">Battle of the Bills</a></li>
</ul></li>
<li class="has-sub"><a href="12-betting-on-beer-or-ice-cream.html#betting-on-beer-or-ice-cream"><span class="toc-section-number">12</span> Betting on Beer (or Ice Cream)</a><ul>
<li class="has-sub"><a href="how-do-statisticians-solve-problems-like-this.html#how-do-statisticians-solve-problems-like-this">How do statisticians solve problems like this?</a><ul>
<li><a href="how-do-statisticians-solve-problems-like-this.html#the-solution-by-counting-or-combinatorics">The solution by counting, or combinatorics</a></li>
<li><a href="how-do-statisticians-solve-problems-like-this.html#the-solution-by-distribution-or-statistics">The solution by distribution, or statistics</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="13-expected-value.html#expected-value"><span class="toc-section-number">13</span> Expected Value</a><ul>
<li class="has-sub"><a href="betting-on-ice-cream.html#betting-on-ice-cream">Betting on ice cream</a><ul>
<li><a href="betting-on-ice-cream.html#by-the-statistical-power-of-grayskull">By the (Statistical) Power of Grayskull</a></li>
</ul></li>
<li class="has-sub"><a href="betting-on-your-future.html#betting-on-your-future">Betting on your Future</a><ul>
<li><a href="betting-on-your-future.html#why-why-why-multiply-ay-ay">Why why why multiply-ay-ay?</a></li>
<li><a href="betting-on-your-future.html#where-do-branching-probabilities-come-from">Where do branching probabilities come from?</a></li>
</ul></li>
</ul></li>
<li><a href="is-the-system-fair.html#is-the-system-fair">Is the System Fair?</a></li>
<li class="has-sub"><a href="14-differences-in-athletics.html#differences-in-athletics"><span class="toc-section-number">14</span> Differences in athletics</a><ul>
<li class="has-sub"><a href="are-professional-basketball-players-taller.html#are-professional-basketball-players-taller">Are professional basketball players taller?</a><ul>
<li><a href="are-professional-basketball-players-taller.html#none-of-this-is-surprising">None of this is surprising</a></li>
</ul></li>
<li><a href="surprising-differences.html#surprising-differences">Surprising differences</a></li>
<li><a href="fairness-on-trial-trans-athletes.html#fairness-on-trial-trans-athletes">Fairness on trial: trans athletes</a></li>
</ul></li>
<li class="has-sub"><a href="15-nyc-covid-19-data.html#nyc-covid-19-data"><span class="toc-section-number">15</span> NYC COVID-19 Data</a><ul>
<li><a href="prologue.html#prologue">Prologue</a></li>
<li class="has-sub"><a href="15-1-part1.html#part1"><span class="toc-section-number">15.1</span> COVID NYC</a><ul>
<li><a href="15-1-part1.html#getting-some-data">Getting some data</a></li>
<li><a href="15-1-part1.html#local-data-on-covid-from-the-city-andor-state">Local data on COVID from the city and/or state</a></li>
</ul></li>
<li class="has-sub"><a href="15-2-part2.html#part2"><span class="toc-section-number">15.2</span> Getting started with US Census data</a><ul>
<li><a href="15-2-part2.html#census-variables">Census Variables</a></li>
<li><a href="15-2-part2.html#geography-units">Geography Units</a></li>
</ul></li>
<li class="has-sub"><a href="15-3-part3.html#part3"><span class="toc-section-number">15.3</span> More (and messier) Census data</a><ul>
<li><a href="15-3-part3.html#exploring-the-acs-data">Exploring the ACS data</a></li>
</ul></li>
<li class="has-sub"><a href="15-4-zipcode.html#zipcode"><span class="toc-section-number">15.4</span> Zipcode tabulation area</a><ul>
<li><a href="15-4-zipcode.html#some-more-variables-to-play-with">Some more variables to play with</a></li>
</ul></li>
<li class="has-sub"><a href="15-5-mapviz.html#mapviz"><span class="toc-section-number">15.5</span> Visualizing data on maps</a><ul>
<li><a href="15-5-mapviz.html#shapefiles">Shapefiles</a></li>
<li><a href="15-5-mapviz.html#coloring-in-the-shapes">Coloring in the shapes</a></li>
<li><a href="15-5-mapviz.html#scatterplots">Scatterplots</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="has-sub"><a href="A-sec-randomness.html#sec:randomness"><span class="toc-section-number">A</span> Randomness</a><ul>
<li><a href="A-1-defining-random-processes.html#defining-random-processes"><span class="toc-section-number">A.1</span> Defining random processes</a></li>
<li><a href="A-2-predictions-about-random-events.html#predictions-about-random-events"><span class="toc-section-number">A.2</span> Predictions about random events</a></li>
<li><a href="A-3-modification-for-continuous-observations.html#modification-for-continuous-observations"><span class="toc-section-number">A.3</span> Modification for continuous observations</a></li>
</ul></li>
<li><a href="references.html#references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="zipcode" class="section level2">
<h2><span class="header-section-number">15.4</span> Zipcode tabulation area</h2>
<p>As we mentioned above, it is possible to query the Census for zipcode tabulation areas. You need to specify which zipcodes, you want. We will get our list from the NYC data, because those are the zipcodes for which we have COVID-19 case counts.</p>
<p>In the code below, I will extract the zip codes and make one long string (“10001, 10002, 10003, 10004, … , 11694, 11697”) to pass to the Census API query.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">nyc_zcta_covid &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/coronavirus-nyc/tests-by-zcta.csv&quot;</span>)</a>
<a class="sourceLine" id="cb152-2" data-line-number="2">nyc_zipcodes &lt;-<span class="st"> </span>nyc_zcta_covid <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(MODZCTA) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb152-3" data-line-number="3"></a>
<a class="sourceLine" id="cb152-4" data-line-number="4"><span class="co"># for the API call, we will want all zipcodes </span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="co"># in plain text with comma separation</span></a>
<a class="sourceLine" id="cb152-6" data-line-number="6">nyc_zipcode_string &lt;-<span class="st"> </span><span class="kw">paste</span>(nyc_zipcodes, <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb152-7" data-line-number="7"></a>
<a class="sourceLine" id="cb152-8" data-line-number="8"><span class="co"># show beginning</span></a>
<a class="sourceLine" id="cb152-9" data-line-number="9"><span class="kw">substr</span>(nyc_zipcode_string, <span class="dv">1</span>,<span class="dv">43</span>)</a></code></pre></div>
<pre><code>## [1] &quot;10001,10002,10003,10004,10005,10006,10007,1&quot;</code></pre>
<p>Having done that, we do our queries as before for borough data, only instead of county and state region, we use “zip code tabulation area:” followed by our long string of zip codes.</p>
<div id="zipcode-level-median-income" class="section level4 unnumbered">
<h4>Zipcode-level median income</h4>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">zcta_income &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>,</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">                         <span class="dt">vintage =</span> <span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">                         <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;B19013_001E&quot;</span>, <span class="st">&quot;B20017_001E&quot;</span>),</a>
<a class="sourceLine" id="cb154-4" data-line-number="4">                         <span class="dt">region =</span> <span class="kw">paste0</span>(<span class="st">&quot;zip code tabulation area:&quot;</span>,nyc_zipcode_string),</a>
<a class="sourceLine" id="cb154-5" data-line-number="5">                         <span class="dt">key=</span>myKey</a>
<a class="sourceLine" id="cb154-6" data-line-number="6">                         )</a></code></pre></div>
<p>Remember how we were renaming all of the Census variables by hand before? That was a pain. Having seen many of the variables that we were interested in, an alternative is to keep a table running of these variables alongside our preferred name.</p>
<p>For example, here is one way to do it. From the 20,000 available census variables, these are the 20-30 variables I may want. (I also included region variables for county and zip code). You can always add to this table.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">acsVars &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/coronavirus-nyc/acs_vars.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb155-2" data-line-number="2"><span class="kw">head</span>(acsVars,<span class="dv">9</span>)</a></code></pre></div>
<pre><code>##                    acsName         realName
## 1                     NAME       countyName
## 2 zip_code_tabulation_area          zipcode
## 3              B01001_001E        Total_Pop
## 4              B01002_001E       Median_Age
## 5              B01002_002E  Median_Age_Male
## 6              B01002_003E   Median_Age_Fem
## 7              B01003_001E       Population
## 8              B19013_001E Median_HH_Income
## 9              B20017_001E    Median_Income</code></pre>
<p>I can then use the named-vector trick from before to convert between the acsName and the realName I like.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">getRealName &lt;-<span class="st"> </span>acsVars<span class="op">$</span>realName</a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="kw">names</span>(getRealName) &lt;-<span class="st"> </span>acsVars<span class="op">$</span>acsName</a></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">names</span>(zcta_income) &lt;-<span class="st"> </span>getRealName[<span class="kw">names</span>(zcta_income)]</a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="kw">head</span>(zcta_income)</a></code></pre></div>
<pre><code>##   zipcode Median_HH_Income Median_Income
## 1   11222            85111         56971
## 2   11233            40449         35666
## 3   11235            52538         37341
## 4   11426            88803         46692
## 5   11427            74581         40135
## 6   11101            65392         49666</code></pre>
<p>That was easy!</p>
</div>
<div id="zipcode-level-race-age-etc." class="section level4 unnumbered">
<h4>Zipcode-level race, age, etc.</h4>
<p>We can now redo the rest of our queries at the zip code level, including any age, sex, and race variables that we want to include.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># get proportion over 65 by adding up lots of variables</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2">zcta_over65 &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>,</a>
<a class="sourceLine" id="cb160-3" data-line-number="3">                             <span class="dt">vintage =</span> <span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb160-4" data-line-number="4">                             <span class="dt">vars =</span> <span class="kw">c</span>(maleOver65Vars,femaleOver65Vars,Total_PopVar),</a>
<a class="sourceLine" id="cb160-5" data-line-number="5">                             <span class="dt">region =</span> <span class="kw">paste0</span>(<span class="st">&quot;zip code tabulation area:&quot;</span>,nyc_zipcode_string),</a>
<a class="sourceLine" id="cb160-6" data-line-number="6">                             <span class="dt">key =</span> myKey</a>
<a class="sourceLine" id="cb160-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb160-8" data-line-number="8"></a>
<a class="sourceLine" id="cb160-9" data-line-number="9">zcta_propOver65 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rowSums</span>(zcta_over65[,<span class="dv">2</span><span class="op">:</span><span class="dv">13</span>])<span class="op">/</span>zcta_over65[,<span class="dv">14</span>],<span class="dv">3</span>)<span class="op">*</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb160-10" data-line-number="10"><span class="co"># combine with zipcode column</span></a>
<a class="sourceLine" id="cb160-11" data-line-number="11">zcta_propOver65 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zipcode=</span>zcta_over65<span class="op">$</span>zip_code_tabulation_area,</a>
<a class="sourceLine" id="cb160-12" data-line-number="12">                         zcta_propOver65, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb160-13" data-line-number="13"></a>
<a class="sourceLine" id="cb160-14" data-line-number="14"><span class="kw">head</span>(zcta_propOver65)</a></code></pre></div>
<pre><code>##   zipcode zcta_propOver65
## 1   11222            10.4
## 2   11233            11.0
## 3   11235            23.5
## 4   11426            15.4
## 5   11427            16.2
## 6   11101             8.3</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="co"># get median age by sex</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2">zcta_SexByAge &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>,</a>
<a class="sourceLine" id="cb162-3" data-line-number="3">                                 <span class="dt">vintage =</span> <span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb162-4" data-line-number="4">                                 <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;B01001_001E&quot;</span>, <span class="st">&quot;B01002_001E&quot;</span>, </a>
<a class="sourceLine" id="cb162-5" data-line-number="5">                                          <span class="st">&quot;B01002_002E&quot;</span>, <span class="st">&quot;B01002_003E&quot;</span>),</a>
<a class="sourceLine" id="cb162-6" data-line-number="6">                                 <span class="dt">region =</span> <span class="kw">paste0</span>(<span class="st">&quot;zip code tabulation area:&quot;</span>,nyc_zipcode_string),</a>
<a class="sourceLine" id="cb162-7" data-line-number="7">                                 <span class="dt">key =</span> myKey</a>
<a class="sourceLine" id="cb162-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb162-9" data-line-number="9"><span class="co"># rename the variables</span></a>
<a class="sourceLine" id="cb162-10" data-line-number="10"><span class="kw">names</span>(zcta_SexByAge) &lt;-<span class="st"> </span>getRealName[<span class="kw">names</span>(zcta_SexByAge)]</a>
<a class="sourceLine" id="cb162-11" data-line-number="11"><span class="kw">head</span>(zcta_SexByAge)</a></code></pre></div>
<pre><code>##   zipcode Total_Pop Median_Age Median_Age_Male Median_Age_Fem
## 1   11222     36492       34.8            35.2           34.3
## 2   11233     76819       33.0            30.5           35.2
## 3   11235     78128       45.1            42.0           47.8
## 4   11426     20801       38.6            37.1           40.2
## 5   11427     24037       42.0            40.0           44.2
## 6   11101     30043       34.1            34.1           34.1</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="co"># get race including Hispanic/Latino category</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2">zcta_race &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>,</a>
<a class="sourceLine" id="cb164-3" data-line-number="3">                       <span class="dt">vintage =</span> <span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb164-4" data-line-number="4">                       <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;B03002_012E&quot;</span>, <span class="st">&quot;B03002_004E&quot;</span>, </a>
<a class="sourceLine" id="cb164-5" data-line-number="5">                                <span class="st">&quot;B03002_003E&quot;</span>, <span class="st">&quot;B03002_006E&quot;</span>,</a>
<a class="sourceLine" id="cb164-6" data-line-number="6">                                <span class="st">&quot;B03002_002E&quot;</span>, <span class="st">&quot;B03002_001E&quot;</span>),</a>
<a class="sourceLine" id="cb164-7" data-line-number="7">                       <span class="dt">region =</span> <span class="kw">paste0</span>(<span class="st">&quot;zip code tabulation area:&quot;</span>,nyc_zipcode_string),</a>
<a class="sourceLine" id="cb164-8" data-line-number="8">                       <span class="dt">key =</span> myKey</a>
<a class="sourceLine" id="cb164-9" data-line-number="9">                       )</a>
<a class="sourceLine" id="cb164-10" data-line-number="10"></a>
<a class="sourceLine" id="cb164-11" data-line-number="11"><span class="co"># rename the variables</span></a>
<a class="sourceLine" id="cb164-12" data-line-number="12"><span class="kw">names</span>(zcta_race) &lt;-<span class="st"> </span>getRealName[<span class="kw">names</span>(zcta_race)]</a>
<a class="sourceLine" id="cb164-13" data-line-number="13"></a>
<a class="sourceLine" id="cb164-14" data-line-number="14"><span class="co"># create the non-Hispanic Other category</span></a>
<a class="sourceLine" id="cb164-15" data-line-number="15">zcta_race &lt;-<span class="st"> </span>zcta_race <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">NH_Other =</span> NH_Total<span class="op">-</span>NH_Black<span class="op">-</span>NH_White<span class="op">-</span>NH_Asian) </a>
<a class="sourceLine" id="cb164-16" data-line-number="16"></a>
<a class="sourceLine" id="cb164-17" data-line-number="17"><span class="co"># convert to proportions by dividing by total</span></a>
<a class="sourceLine" id="cb164-18" data-line-number="18">zcta_race_proportion &lt;-<span class="st"> </span>zcta_race  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute</span>(<span class="dt">Hisp_Latin =</span> Hisp_Latin<span class="op">/</span>Total_HispRace, </a>
<a class="sourceLine" id="cb164-19" data-line-number="19">                                                 <span class="dt">NH_Black =</span> NH_Black<span class="op">/</span>Total_HispRace,</a>
<a class="sourceLine" id="cb164-20" data-line-number="20">                                                 <span class="dt">NH_White=</span>NH_White<span class="op">/</span>Total_HispRace,</a>
<a class="sourceLine" id="cb164-21" data-line-number="21">                                                 <span class="dt">NH_Asian=</span>NH_Asian<span class="op">/</span>Total_HispRace,</a>
<a class="sourceLine" id="cb164-22" data-line-number="22">                                                 <span class="dt">NH_Other=</span>NH_Other<span class="op">/</span>Total_HispRace) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-23" data-line-number="23"><span class="st">                                      </span><span class="kw">round</span>(., <span class="dt">digits=</span><span class="dv">3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb164-24" data-line-number="24"></a>
<a class="sourceLine" id="cb164-25" data-line-number="25">zcta_race_proportion &lt;-<span class="st"> </span><span class="kw">data.frame</span>(zcta_race <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(zipcode, Total_HispRace),</a>
<a class="sourceLine" id="cb164-26" data-line-number="26">                              zcta_race_proportion) </a>
<a class="sourceLine" id="cb164-27" data-line-number="27"><span class="kw">head</span>(zcta_race_proportion)</a></code></pre></div>
<pre><code>##   zipcode Total_HispRace Hisp_Latin NH_Black NH_White NH_Asian NH_Other
## 1   11222          36492       14.2      3.7     73.4      5.0      3.7
## 2   11233          76819       16.0     73.6      6.9      1.6      1.8
## 3   11235          78128        8.3      2.3     71.9     14.4      3.1
## 4   11426          20801       18.9      6.1     28.0     44.1      2.7
## 5   11427          24037       19.5     19.7     19.8     31.1      9.9
## 6   11101          30043       26.3     14.5     32.4     22.5      4.2</code></pre>
</div>
<div id="some-more-variables-to-play-with" class="section level3 unnumbered">
<h3>Some more variables to play with</h3>
<p>While we’re at it, we can keep collecting variables related to the reports we read. For example, household size seems to be associated with prevalence of COVID-19 and so does the share of college-educated adults (recall the image at the beginning of this chapter—by the way, we’re almost ready to make our own, even better, version of it). The ACS5 variables we will need are:</p>
<div id="household-size" class="section level4 unnumbered">
<h4>Household size</h4>
<ul>
<li>B08201_007E Estimate!!Total!!1-person household</li>
<li>B08201_013E Estimate!!Total!!2-person household</li>
<li>B08201_019E Estimate!!Total!!3-person household</li>
<li>B08201_025E Estimate!!Total!!4-or-more-person household</li>
</ul>
</div>
<div id="educational-attainment" class="section level4 unnumbered">
<h4>Educational attainment</h4>
<ul>
<li>B15003_022E Estimate!!Total!!Bachelor’s degree<br />
</li>
<li>B15003_023E Estimate!!Total!!Master’s degree<br />
</li>
<li>B15003_024E Estimate!!Total!!Professional school degree</li>
<li>B15003_025E Estimate!!Total!!Doctorate degree</li>
</ul>
<p>I’ve already added those to the <code>acsVars</code> table, so we can use the <code>getRealName</code> vector to convert the names to human-readable versions.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">zcta_college_hh &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>,</a>
<a class="sourceLine" id="cb166-2" data-line-number="2">                             <span class="dt">vintage =</span> <span class="dv">2018</span>,</a>
<a class="sourceLine" id="cb166-3" data-line-number="3">                             <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;B15003_022E&quot;</span>, <span class="st">&quot;B15003_023E&quot;</span>, <span class="st">&quot;B15003_024E&quot;</span>, </a>
<a class="sourceLine" id="cb166-4" data-line-number="4">                                      <span class="st">&quot;B15003_025E&quot;</span>, <span class="st">&quot;B15003_001E&quot;</span>,</a>
<a class="sourceLine" id="cb166-5" data-line-number="5">                                      <span class="st">&quot;B08201_007E&quot;</span>, <span class="st">&quot;B08201_013E&quot;</span>, </a>
<a class="sourceLine" id="cb166-6" data-line-number="6">                                      <span class="st">&quot;B08201_019E&quot;</span>, <span class="st">&quot;B08201_025E&quot;</span>),</a>
<a class="sourceLine" id="cb166-7" data-line-number="7">                             <span class="dt">region =</span> <span class="kw">paste0</span>(<span class="st">&quot;zip code tabulation area:&quot;</span>,nyc_zipcode_string),</a>
<a class="sourceLine" id="cb166-8" data-line-number="8">                             <span class="dt">key =</span> myKey</a>
<a class="sourceLine" id="cb166-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb166-10" data-line-number="10"></a>
<a class="sourceLine" id="cb166-11" data-line-number="11"><span class="co"># give variable names</span></a>
<a class="sourceLine" id="cb166-12" data-line-number="12"><span class="kw">names</span>(zcta_college_hh) =<span class="st"> </span>getRealName[<span class="kw">names</span>(zcta_college_hh)]</a>
<a class="sourceLine" id="cb166-13" data-line-number="13"></a>
<a class="sourceLine" id="cb166-14" data-line-number="14"><span class="co"># Reports mention &quot;College&quot;, but this presumably means Bachelors or higher</span></a>
<a class="sourceLine" id="cb166-15" data-line-number="15">zcta_edu_hh &lt;-<span class="st"> </span>zcta_college_hh <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-16" data-line-number="16"><span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">Bach_plus_prop =</span> <span class="kw">round</span>( (Bachelors <span class="op">+</span><span class="st"> </span>Masters <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-17" data-line-number="17"><span class="st">                                                    </span>Professional <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-18" data-line-number="18"><span class="st">                                                    </span>Doctorate)<span class="op">/</span>Total_EducPop,<span class="dv">3</span>)<span class="op">*</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb166-19" data-line-number="19"></a>
<a class="sourceLine" id="cb166-20" data-line-number="20"><span class="co"># create the average household size variable</span></a>
<a class="sourceLine" id="cb166-21" data-line-number="21">zcta_edu_hh &lt;-<span class="st"> </span>zcta_edu_hh <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-22" data-line-number="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AvgHH =</span> (HH1pers<span class="op">+</span><span class="dv">2</span><span class="op">*</span>HH2pers<span class="op">+</span><span class="dv">3</span><span class="op">*</span>HH3pers<span class="op">+</span><span class="dv">4</span><span class="op">*</span>HH4plus)<span class="op">/</span>(HH1pers<span class="op">+</span>HH2pers<span class="op">+</span>HH3pers<span class="op">+</span>HH4plus)) </a>
<a class="sourceLine" id="cb166-23" data-line-number="23"></a>
<a class="sourceLine" id="cb166-24" data-line-number="24"><span class="kw">head</span>(zcta_edu_hh)</a></code></pre></div>
<pre><code>##   zipcode Bachelors Masters Professional Doctorate Total_EducPop HH1pers
## 1   11222     11797    4846          814       271         30177    6139
## 2   11233      8449    3310          430       321         49821    9476
## 3   11235     16573    8694         2083      1053         59442   10886
## 4   11426      3192    1711          455       143         14569    1256
## 5   11427      3395    1651          372       153         17320    1691
## 6   11101      6342    2746         1145       394         22131    4692
##   HH2pers HH3pers HH4plus Bach_plus_prop    AvgHH
## 1    6777    2419    1921           58.7 2.007070
## 2    8429    5052    6388           25.1 2.284614
## 3    9914    4816    6653           47.8 2.224240
## 4    1757     924    2419           37.8 2.708936
## 5    1938    1318    2553           32.2 2.631067
## 6    4919    1809    1749           48.0 2.046701</code></pre>
<p>Having gathered the information in various tables (zcta_income, zcta_propOver65, zcta_SexByAge
zcta_race_proportion, zcta_edu_hh), we can finally combine them all into one giant zipcode data frame:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">zcta_join &lt;-<span class="st"> </span>zcta_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(zcta_propOver65, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(zcta_SexByAge, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-4" data-line-number="4"><span class="st">  </span><span class="kw">left_join</span>(zcta_race_proportion, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-5" data-line-number="5"><span class="st">  </span><span class="kw">left_join</span>(zcta_edu_hh, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb168-6" data-line-number="6"><span class="st">  </span><span class="kw">left_join</span>(nyc_zipcode_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">zipcode =</span> <span class="kw">as.character</span>(zipcode)), </a>
<a class="sourceLine" id="cb168-7" data-line-number="7">            <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>))</a>
<a class="sourceLine" id="cb168-8" data-line-number="8"></a>
<a class="sourceLine" id="cb168-9" data-line-number="9"><span class="kw">names</span>(zcta_join)</a></code></pre></div>
<pre><code>##  [1] &quot;zipcode&quot;           &quot;Median_HH_Income&quot;  &quot;Median_Income&quot;    
##  [4] &quot;zcta_propOver65&quot;   &quot;Total_Pop&quot;         &quot;Median_Age&quot;       
##  [7] &quot;Median_Age_Male&quot;   &quot;Median_Age_Fem&quot;    &quot;Total_HispRace&quot;   
## [10] &quot;Hisp_Latin&quot;        &quot;NH_Black&quot;          &quot;NH_White&quot;         
## [13] &quot;NH_Asian&quot;          &quot;NH_Other&quot;          &quot;Bachelors&quot;        
## [16] &quot;Masters&quot;           &quot;Professional&quot;      &quot;Doctorate&quot;        
## [19] &quot;Total_EducPop&quot;     &quot;HH1pers&quot;           &quot;HH2pers&quot;          
## [22] &quot;HH3pers&quot;           &quot;HH4plus&quot;           &quot;Bach_plus_prop&quot;   
## [25] &quot;AvgHH&quot;             &quot;Positive&quot;          &quot;Total&quot;            
## [28] &quot;zcta_cum.perc_pos&quot;</code></pre>
<p>And there you have it. 27 variables, each associated with a NYC zip code. Now what do you do once you have all of that? Probably make some pictures. Finally!</p>
</div>
</div>
</div>
<p style="text-align: center;">
<a href="15-3-part3.html"><button class="btn btn-default">Previous</button></a>
<a href="15-5-mapviz.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
