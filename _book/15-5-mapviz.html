<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="15.5 Visualizing data on maps | Carpe Datum" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="ybergner/carpe-datum" />

<meta name="author" content="Yoav Bergner" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="15.5 Visualizing data on maps | Carpe Datum">

<title>15.5 Visualizing data on maps | Carpe Datum</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#preface">Preface</a><ul>
<li><a href="caveat.html#caveat">Caveat</a></li>
<li class="has-sub"><a href="guiding-principles-in-this-book.html#guiding-principles-in-this-book">Guiding principles in this book</a><ul>
<li><a href="guiding-principles-in-this-book.html#question-driven">Question-driven</a></li>
<li><a href="guiding-principles-in-this-book.html#no-proofs">No proofs</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="how-many-kinds-of-people-are-there.html#how-many-kinds-of-people-are-there">How Many Kinds of People Are There?</a><ul>
<li><a href="things-are-about-to-get-meta-right-from-the-start.html#things-are-about-to-get-meta-right-from-the-start">Things are about to get meta right from the start</a></li>
</ul></li>
<li class="has-sub"><a href="1-categories.html#categories"><span class="toc-section-number">1</span> Categories, counts, and kinds</a><ul>
<li><a href="1-categories.html#two-kinds-of-people">Two Kinds of People</a></li>
<li><a href="1-categories.html#samples-and-populations-a-statistical-caveat">Samples and Populations: A Statistical Caveat</a></li>
<li><a href="1-categories.html#a-psychological-caveat">A Psychological Caveat</a></li>
<li><a href="1-categories.html#summarizing-data">Summarizing data</a></li>
<li><a href="1-categories.html#checkpoint">Checkpoint</a></li>
</ul></li>
<li class="has-sub"><a href="2-dimensions.html#dimensions"><span class="toc-section-number">2</span> Dimensions</a><ul>
<li><a href="independence-association-and-contingency.html#independence-association-and-contingency">Independence, Association, and Contingency</a></li>
<li><a href="latent-factors-and-measurement.html#latent-factors-and-measurement">Latent Factors and Measurement</a></li>
</ul></li>
<li class="has-sub"><a href="3-test-indep.html#test-indep"><span class="toc-section-number">3</span> Tests of independence: A first look starring alternate universes</a><ul>
<li><a href="rise-of-the-machines.html#rise-of-the-machines">Rise of the machines</a></li>
<li><a href="hypothesis-testing-just-happened.html#hypothesis-testing-just-happened">Hypothesis testing just happened</a></li>
<li><a href="caveats.html#caveats">Caveats</a></li>
<li class="has-sub"><a href="sampling-simulations-and-randomness.html#sampling-simulations-and-randomness">Sampling, simulations, and randomness</a><ul>
<li><a href="sampling-simulations-and-randomness.html#tossing-virtual-coins">Tossing (virtual) coins</a></li>
<li><a href="sampling-simulations-and-randomness.html#but-some-observations-do-occur-more-than-others">But some observations <em>do</em> occur more than others</a></li>
</ul></li>
<li><a href="recap.html#recap">Recap</a></li>
</ul></li>
<li class="has-sub"><a href="4-shades.html#shades"><span class="toc-section-number">4</span> (An Infinite Number of) Shades of Gray (or Brown)</a><ul>
<li class="has-sub"><a href="poopiness.html#poopiness">Poopiness</a><ul>
<li><a href="poopiness.html#mixtures">Mixtures</a></li>
</ul></li>
<li class="has-sub"><a href="crappiness.html#crappiness">Crappiness</a><ul>
<li><a href="crappiness.html#check-your-understanding">Check your understanding</a></li>
</ul></li>
</ul></li>
<li><a href="5-cut-scores-and-abnormality.html#cut-scores-and-abnormality"><span class="toc-section-number">5</span> Cut Scores and Abnormality</a></li>
<li class="has-sub"><a href="6-the-modal-american.html#the-modal-american"><span class="toc-section-number">6</span> The Modal American</a><ul>
<li><a href="6-the-modal-american.html#step-one-categories">Step one: categories</a></li>
<li><a href="6-the-modal-american.html#step-two-contingency-table">Step two: contingency table</a></li>
<li><a href="6-the-modal-american.html#exercises">Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="7-sixteen-personalities-or-five-factors.html#sixteen-personalities-or-five-factors"><span class="toc-section-number">7</span> Sixteen Personalities or Five Factors?</a><ul>
<li><a href="7-sixteen-personalities-or-five-factors.html#mbti">MBTI</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#big-five">Big Five</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#twenty-questions-about-extraversion">Twenty Questions (about Extraversion)</a></li>
<li><a href="7-sixteen-personalities-or-five-factors.html#but-whats-the-point">But what’s the point?</a></li>
<li><a href="still-meta-after-all-these-pages.html#still-meta-after-all-these-pages">Still meta after all these pages</a></li>
</ul></li>
<li class="has-sub"><a href="8-when-and-how-will-you-die.html#when-and-how-will-you-die"><span class="toc-section-number">8</span> When and How Will You Die?</a><ul>
<li class="has-sub"><a href="not-quite-death-but-um-rain.html#not-quite-death-but-um-rain">Not Quite Death, but, um… Rain?</a><ul>
<li><a href="not-quite-death-but-um-rain.html#stochastic-vs-deterministic-relationships">Stochastic vs Deterministic relationships</a></li>
</ul></li>
<li class="has-sub"><a href="ways-of-thinking-about-probabilistic-statements.html#ways-of-thinking-about-probabilistic-statements">Ways of thinking about probabilistic statements</a><ul>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#ensembles">Ensembles</a></li>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#degree-of-belief">Degree of belief</a></li>
<li><a href="ways-of-thinking-about-probabilistic-statements.html#decisions">Decisions</a></li>
</ul></li>
<li><a href="death.html#death">Death</a></li>
</ul></li>
<li class="has-sub"><a href="9-conditional-death.html#conditional-death"><span class="toc-section-number">9</span> Conditional Death</a><ul>
<li><a href="9-conditional-death.html#how-does-the-death-simulation-work">How does the death (simulation) work?</a></li>
</ul></li>
<li class="has-sub"><a href="10-somefacts.html#somefacts"><span class="toc-section-number">10</span> Some facts about Probabilities</a><ul>
<li><a href="conditional-probabilities.html#conditional-probabilities">Conditional Probabilities</a></li>
<li class="has-sub"><a href="conditional-death-again.html#conditional-death-again">Conditional death, again</a><ul>
<li><a href="conditional-death-again.html#just-to-make-things-weird">Just to make things weird</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="11-how-you-will-die-causes-or-conditions.html#how-you-will-die-causes-or-conditions"><span class="toc-section-number">11</span> How You Will Die: Causes or Conditions?</a><ul>
<li><a href="causes-of-death-colloquially.html#causes-of-death-colloquially">Causes of death, colloquially</a></li>
<li><a href="hold-my-beer.html#hold-my-beer">Hold my beer</a></li>
<li><a href="non-deterministic-causation.html#non-deterministic-causation">Non-deterministic Causation</a></li>
<li><a href="testing-for-an-association-between-two-variables.html#testing-for-an-association-between-two-variables">Testing for an association between two variables</a></li>
</ul></li>
<li class="has-sub"><a href="will-you-make-money.html#will-you-make-money">Will You Make Money?</a><ul>
<li><a href="battle-of-the-bills.html#battle-of-the-bills">Battle of the Bills</a></li>
</ul></li>
<li class="has-sub"><a href="12-betting-on-beer-or-ice-cream.html#betting-on-beer-or-ice-cream"><span class="toc-section-number">12</span> Betting on Beer (or Ice Cream)</a><ul>
<li class="has-sub"><a href="how-do-statisticians-solve-problems-like-this.html#how-do-statisticians-solve-problems-like-this">How do statisticians solve problems like this?</a><ul>
<li><a href="how-do-statisticians-solve-problems-like-this.html#the-solution-by-counting-or-combinatorics">The solution by counting, or combinatorics</a></li>
<li><a href="how-do-statisticians-solve-problems-like-this.html#the-solution-by-distribution-or-statistics">The solution by distribution, or statistics</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="13-expected-value.html#expected-value"><span class="toc-section-number">13</span> Expected Value</a><ul>
<li class="has-sub"><a href="betting-on-ice-cream.html#betting-on-ice-cream">Betting on ice cream</a><ul>
<li><a href="betting-on-ice-cream.html#by-the-statistical-power-of-grayskull">By the (Statistical) Power of Grayskull</a></li>
</ul></li>
<li class="has-sub"><a href="betting-on-your-future.html#betting-on-your-future">Betting on your Future</a><ul>
<li><a href="betting-on-your-future.html#why-why-why-multiply-ay-ay">Why why why multiply-ay-ay?</a></li>
<li><a href="betting-on-your-future.html#where-do-branching-probabilities-come-from">Where do branching probabilities come from?</a></li>
</ul></li>
</ul></li>
<li><a href="is-the-system-fair.html#is-the-system-fair">Is the System Fair?</a></li>
<li class="has-sub"><a href="14-differences-in-athletics.html#differences-in-athletics"><span class="toc-section-number">14</span> Differences in athletics</a><ul>
<li class="has-sub"><a href="are-professional-basketball-players-taller.html#are-professional-basketball-players-taller">Are professional basketball players taller?</a><ul>
<li><a href="are-professional-basketball-players-taller.html#none-of-this-is-surprising">None of this is surprising</a></li>
</ul></li>
<li><a href="surprising-differences.html#surprising-differences">Surprising differences</a></li>
<li><a href="fairness-on-trial-trans-athletes.html#fairness-on-trial-trans-athletes">Fairness on trial: trans athletes</a></li>
</ul></li>
<li class="has-sub"><a href="15-nyc-covid-19-data.html#nyc-covid-19-data"><span class="toc-section-number">15</span> NYC COVID-19 Data</a><ul>
<li><a href="prologue.html#prologue">Prologue</a></li>
<li class="has-sub"><a href="15-1-part1.html#part1"><span class="toc-section-number">15.1</span> COVID NYC</a><ul>
<li><a href="15-1-part1.html#getting-some-data">Getting some data</a></li>
<li><a href="15-1-part1.html#local-data-on-covid-from-the-city-andor-state">Local data on COVID from the city and/or state</a></li>
</ul></li>
<li class="has-sub"><a href="15-2-part2.html#part2"><span class="toc-section-number">15.2</span> Getting started with US Census data</a><ul>
<li><a href="15-2-part2.html#census-variables">Census Variables</a></li>
<li><a href="15-2-part2.html#geography-units">Geography Units</a></li>
</ul></li>
<li class="has-sub"><a href="15-3-part3.html#part3"><span class="toc-section-number">15.3</span> More (and messier) Census data</a><ul>
<li><a href="15-3-part3.html#exploring-the-acs-data">Exploring the ACS data</a></li>
</ul></li>
<li class="has-sub"><a href="15-4-zipcode.html#zipcode"><span class="toc-section-number">15.4</span> Zipcode tabulation area</a><ul>
<li><a href="15-4-zipcode.html#some-more-variables-to-play-with">Some more variables to play with</a></li>
</ul></li>
<li class="has-sub"><a href="15-5-mapviz.html#mapviz"><span class="toc-section-number">15.5</span> Visualizing data on maps</a><ul>
<li><a href="15-5-mapviz.html#shapefiles">Shapefiles</a></li>
<li><a href="15-5-mapviz.html#coloring-in-the-shapes">Coloring in the shapes</a></li>
<li><a href="15-5-mapviz.html#scatterplots">Scatterplots</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="has-sub"><a href="A-sec-randomness.html#sec:randomness"><span class="toc-section-number">A</span> Randomness</a><ul>
<li><a href="A-1-defining-random-processes.html#defining-random-processes"><span class="toc-section-number">A.1</span> Defining random processes</a></li>
<li><a href="A-2-predictions-about-random-events.html#predictions-about-random-events"><span class="toc-section-number">A.2</span> Predictions about random events</a></li>
<li><a href="A-3-modification-for-continuous-observations.html#modification-for-continuous-observations"><span class="toc-section-number">A.3</span> Modification for continuous observations</a></li>
</ul></li>
<li><a href="references.html#references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="mapviz" class="section level2">
<h2><span class="header-section-number">15.5</span> Visualizing data on maps</h2>
<p>The whole point of using zip codes as units was that they represent distinct geographic areas. It is not easy to make sense of a list of 177 household income values, ordered by zip code. But if we convert these values to colors or shades and use those to fill in the zip code boundaries of a map, then we can “see” where the money is and where it isn’t.</p>
<div id="shapefiles" class="section level3 unnumbered">
<h3>Shapefiles</h3>
<p>To carry out this feat, we will need to enlist the help of a <strong>shapefile</strong>, which is a data format that was specifically invented for geographical information systems (GIS). You don’t need to understand the detailed structure of a shapefile. You only need to know that it will allow you to map, say, the zip code 10003 to some region on a drawing.</p>
<p>So we will need a shapefile for NYC zip codes. Search for this on the internet, and you’ll get one <a href="https://catalog.data.gov/dataset/zip-code-boundaries" target="_blank">here</a>. We will need the R package that will do the translation work for us. It is called “R geospatial data abstraction library (<code>rgdal</code>).” Lastly, to produce images like you see in the media, we might need some color palettes. These will map numbers (e.g., proportion over 65) to colors in ways that are designed to be visually distinctive.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="co">#load R geospatial data abstraction library</span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb170-3" data-line-number="3"></a>
<a class="sourceLine" id="cb170-4" data-line-number="4"><span class="co">#load additional viz libraries for color paletts</span></a>
<a class="sourceLine" id="cb170-5" data-line-number="5"><span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb170-6" data-line-number="6"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb170-7" data-line-number="7"></a>
<a class="sourceLine" id="cb170-8" data-line-number="8"><span class="co">#read in the shape file for NYC zip codes</span></a>
<a class="sourceLine" id="cb170-9" data-line-number="9">filepath &lt;-<span class="st"> &quot;Shape_Files/ZIP_CODE_040114.shp&quot;</span></a>
<a class="sourceLine" id="cb170-10" data-line-number="10">NYC_zips &lt;-<span class="st"> </span><span class="kw">readOGR</span>(filepath, <span class="dt">stringsAsFactors =</span> F)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/bergner/GitHub/carpe-datum/Shape_Files/ZIP_CODE_040114.shp&quot;, layer: &quot;ZIP_CODE_040114&quot;
## with 263 features
## It has 12 fields</code></pre>
<p>The data structure of the shapefile is pretty complicated. (Look inside, I dare you!)
But right off the bat, we can plot it</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1"><span class="co"># quartz()</span></a>
<a class="sourceLine" id="cb172-2" data-line-number="2"><span class="kw">plot</span>(NYC_zips)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-81-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Woot! There be zipcodes! Without any other data. Just… boundaries. If you are following along in an RStudio session, you can get a better quality image by uncommenting the <code>quartz()</code> command. This will open the drawing in a new window. Note that it takes a little while to finish, and you can see it draw the boundaries of each zipcode one at a time… aww!</p>
<p>To add colors or shades, we will need to send color/shade information along with the plot instruction… but there’s something else we need to do first.</p>
<p>How many zip codes are in our data set? The answer can be found by the number of rows in our data frame:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">nrow</span>(zcta_join)</a></code></pre></div>
<pre><code>## [1] 177</code></pre>
<p>Is this the same as the number of zip codes in our shapefile? If it isn’t, then we will get issues when we combine the data we want to map with the geographic boundary data.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="co">#get zipcodes from shape file</span></a>
<a class="sourceLine" id="cb175-2" data-line-number="2">shapezips &lt;-<span class="st"> </span>NYC_zips<span class="op">@</span>data<span class="op">$</span>ZIPCODE </a>
<a class="sourceLine" id="cb175-3" data-line-number="3"><span class="kw">length</span>(shapezips)</a></code></pre></div>
<pre><code>## [1] 263</code></pre>
<p>Not only are there more zipcodes in the shapefile than we have data for, but, for whatever reason involving the design of shapefiles, some zipcodes appear more than once. This is a small nuisance, but it can be solved by using <code>join</code> as before. The main idea is that we pass the data we have, and provide “missing” values (<code>NA</code> in R) for everything else.
Here is how to repackage our dataset to fit with the shapefile</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="co"># start with one zipcode variable for everything in the shapefile</span></a>
<a class="sourceLine" id="cb177-2" data-line-number="2">mapData &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">zipcode =</span> shapezips, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb177-3" data-line-number="3"></a>
<a class="sourceLine" id="cb177-4" data-line-number="4"><span class="co"># add the rest of our data to this</span></a>
<a class="sourceLine" id="cb177-5" data-line-number="5">mapData &lt;-<span class="st"> </span><span class="kw">left_join</span>(mapData, zcta_join, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;zipcode&quot;</span>))</a></code></pre></div>
<p>Simple enough. We expected there to be zipcodes with missing census/COVID-19 data. Indeed, here are some:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">tail</span>(mapData)</a></code></pre></div>
<pre><code>##     zipcode Median_HH_Income Median_Income zcta_propOver65 Total_Pop Median_Age
## 258   11414            71648         45640            22.0     29219       45.0
## 259   10310            72093         44590            13.4     23262       38.8
## 260   11693            59431         44674            12.3     12919       39.5
## 261   11249               NA            NA              NA        NA         NA
## 262   10162               NA            NA              NA        NA         NA
## 263   10119               NA            NA              NA        NA         NA
##     Median_Age_Male Median_Age_Fem Total_HispRace Hisp_Latin NH_Black NH_White
## 258            43.9           46.0          29219       22.3      1.8     67.8
## 259            38.2           39.1          23262       31.6     18.9     41.6
## 260            35.2           43.1          12919       29.5     16.1     46.9
## 261              NA             NA             NA         NA       NA       NA
## 262              NA             NA             NA         NA       NA       NA
## 263              NA             NA             NA         NA       NA       NA
##     NH_Asian NH_Other Bachelors Masters Professional Doctorate Total_EducPop
## 258      5.0      3.0      3828    1737          419        50         21607
## 259      6.2      1.7      2995    1768          409       150         15599
## 260      4.0      3.5      1401     828          114        10          8924
## 261       NA       NA        NA      NA           NA        NA            NA
## 262       NA       NA        NA      NA           NA        NA            NA
## 263       NA       NA        NA      NA           NA        NA            NA
##     HH1pers HH2pers HH3pers HH4plus Bach_plus_prop    AvgHH Positive Total
## 258    2603    3398    2151    2528           27.9 2.431086      588  1004
## 259    1971    2326    1628    2421           34.1 2.539061      506  1136
## 260    1469    1630     779     967           26.4 2.256760      256   444
## 261      NA      NA      NA      NA             NA       NA       NA    NA
## 262      NA      NA      NA      NA             NA       NA       NA    NA
## 263      NA      NA      NA      NA             NA       NA       NA    NA
##     zcta_cum.perc_pos
## 258             58.57
## 259             44.54
## 260             57.66
## 261                NA
## 262                NA
## 263                NA</code></pre>
<p>Why are these zipcodes (and others) missing data? It’s hard to know, and you need to look at it case by case. Some of these are zipcodes for special areas, like industrial zones, airports. and train stations. (10119 appears to be Penn Station).</p>
</div>
<div id="coloring-in-the-shapes" class="section level3 unnumbered">
<h3>Coloring in the shapes</h3>
<p>So, suppose we want to color in the zip code boundaries to indicate the share of college educated adults in each region. We either have the college rate in our data frame, or we have the data needed to calculate it. (In this case, we might have total college and total population, so we can compute the case rate.)</p>
<p>But what is the right way to map case rate, which is a numeric/quantitative variable to color? What kind of variable is color? This is a profound question that has to do with perception through our sense. Questions regarding mental perception of sounds, colors, or short-duration verbal cues, for example, are the domain of <strong>psychophysics</strong> (yes, that’s a real thing!)</p>
<p>Without delving too deeply into this problem, we can at least try to emulate the common practices in similar visualizations. What you’ll see is that in many cases, rather than mapping a continuous range of values (e.g., COVID-19 case rate) to a continuous range of colors/shades, the values and the colors are discretized into a small number of levels. Each zip code area, then, is mapped to one of these levels and thus one of the corresponding colors/shades. In the media reports referenced early in this chapter, five levels was pretty typical.</p>
<div id="an-important-digression-on-choosing-your-levels" class="section level4 unnumbered">
<h4>An important digression on choosing your levels</h4>
<p>Let’s say we want five levels. Sometimes the level-groupings of data are associated with quintiles. Recall that quintiles divide our ordered data set into five equally-sized partitions. Meaning, we will have the same number of zip codes in the lowest quintile, and the next lowest, and so on. But one could also make five partitions where the <em>range of values is equally sized</em> but the number of cases in each partition is not. Think of the bin-breaks in a histogram. These are equally-sized ranges, but each bin does not necessarily have the same number of cases. Say, if the distribution is bell-shaped.</p>
<p>Here is an example using fake data, drawn in fact from a normal distribution:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="co"># make some data</span></a>
<a class="sourceLine" id="cb180-2" data-line-number="2">someNormalData &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb180-3" data-line-number="3"></a>
<a class="sourceLine" id="cb180-4" data-line-number="4"><span class="co"># slice it up into 5 groups, two ways:</span></a>
<a class="sourceLine" id="cb180-5" data-line-number="5">quintileAssignments &lt;-<span class="st"> </span><span class="kw">ntile</span>(someNormalData, <span class="dt">n=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb180-6" data-line-number="6">partitionRanges &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">2.5</span>,<span class="op">-</span><span class="fl">1.5</span>,<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>,<span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb180-7" data-line-number="7">equalRangeAssignments &lt;-<span class="st"> </span><span class="kw">cut</span>(someNormalData, partitionRanges)</a>
<a class="sourceLine" id="cb180-8" data-line-number="8"></a>
<a class="sourceLine" id="cb180-9" data-line-number="9"><span class="co"># show how many cases are bucketed into each level</span></a>
<a class="sourceLine" id="cb180-10" data-line-number="10"><span class="kw">table</span>(quintileAssignments)</a></code></pre></div>
<pre><code>## quintileAssignments
##  1  2  3  4  5 
## 40 40 40 40 40</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1"><span class="kw">table</span>(equalRangeAssignments)</a></code></pre></div>
<pre><code>## equalRangeAssignments
## (-2.5,-1.5] (-1.5,-0.5]  (-0.5,0.5]   (0.5,1.5]   (1.5,2.5] 
##           1          28         142          29           0</code></pre>
<p>As you can see, the number of cases that get collected in these buckets can be different, depending on how we slice it. If we were mapping zipcodes to colors based on the values of some data such as these, then we would get very different maps. In the quantile case (quintiles, specifically!), we would have our colors spread out, or varying, more. In the equal range case, we may have only a few extreme colors, while the majority of the zipcodes are the same color. All of this happened because our data distribution was bell-shaped. Admittedly, if the distribution were flat (also known as a uniform distribution), then both methods would divide the cases similarly.</p>
<p>By the way, to see what the actual ranges of the quintiles are (this depends on the data you have), you can do this:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="kw">quantile</span>(someNormalData, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out=</span><span class="dv">6</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2"><span class="st">  </span><span class="kw">cut</span>(someNormalData, .) <span class="op">%&gt;%</span><span class="st"> </span>levels</a></code></pre></div>
<pre><code>## [1] &quot;(-1.56,-0.387]&quot;   &quot;(-0.387,-0.0771]&quot; &quot;(-0.0771,0.138]&quot;  &quot;(0.138,0.417]&quot;   
## [5] &quot;(0.417,1.39]&quot;</code></pre>
<p>This ends the digression. The reason it is important is that this choice of how to make your level assignments will ultimately change how the map looks, and thus what it communicates. We will have a chance to see this play out next.</p>
</div>
<div id="college" class="section level4 unnumbered">
<h4>College</h4>
<p>We already have a variable called “Bach_plus_prop” which accounts for the proportion of college among adults 25 and over. Let’s see how this actual data set can get mapped. Because this has already gotten complicated enough, I’ve wrapped a couple of steps together into a function called <code>getShapeColors</code>. Feel free to simply ignore this if you already have enough on your mind and just skip to the example of how to use it.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="co"># Safe to ignore this chunk</span></a>
<a class="sourceLine" id="cb186-2" data-line-number="2">getShapeColors &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">missingcol=</span><span class="st">&quot;gray88&quot;</span>, </a>
<a class="sourceLine" id="cb186-3" data-line-number="3">                           <span class="dt">rdgrbl=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">mycolors=</span><span class="ot">NULL</span>){</a>
<a class="sourceLine" id="cb186-4" data-line-number="4">  <span class="cf">if</span>(<span class="kw">length</span>(nbreaks) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb186-5" data-line-number="5">    mybreaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="kw">quantile</span>(data,</a>
<a class="sourceLine" id="cb186-6" data-line-number="6">                               <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out=</span>nbreaks<span class="op">+</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb186-7" data-line-number="7">                               <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb186-8" data-line-number="8">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb186-9" data-line-number="9">    mybreaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,nbreaks)</a>
<a class="sourceLine" id="cb186-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb186-11" data-line-number="11">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(mycolors)){</a>
<a class="sourceLine" id="cb186-12" data-line-number="12">    mycols &lt;-<span class="st"> </span>mycolors</a>
<a class="sourceLine" id="cb186-13" data-line-number="13">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb186-14" data-line-number="14">    mycols &lt;-<span class="st"> </span><span class="kw">rgb</span>(rdgrbl[<span class="dv">1</span>],rdgrbl[<span class="dv">2</span>],rdgrbl[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb186-15" data-line-number="15">                  <span class="kw">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.65</span>, <span class="dt">length.out =</span> <span class="kw">length</span>(mybreaks)<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb186-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb186-17" data-line-number="17">  mycols[<span class="dv">1</span>] &lt;-<span class="st"> </span>missingcol</a>
<a class="sourceLine" id="cb186-18" data-line-number="18">  data[<span class="kw">is.na</span>(data)] &lt;-<span class="st"> </span><span class="fl">-.1</span></a>
<a class="sourceLine" id="cb186-19" data-line-number="19">  mycolorscheme &lt;-<span class="st"> </span><span class="kw">cut</span>(data, mybreaks) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-20" data-line-number="20"><span class="st">    </span><span class="kw">as.numeric</span>()</a>
<a class="sourceLine" id="cb186-21" data-line-number="21">  mycolorscheme &lt;-<span class="st"> </span>mycols[mycolorscheme]</a>
<a class="sourceLine" id="cb186-22" data-line-number="22">  levs &lt;-<span class="st"> </span><span class="kw">levels</span>(<span class="kw">cut</span>(data, mybreaks))</a>
<a class="sourceLine" id="cb186-23" data-line-number="23">  levs[<span class="dv">1</span>] &lt;-<span class="st"> &quot;No Data&quot;</span></a>
<a class="sourceLine" id="cb186-24" data-line-number="24">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">regionValues=</span>mycolorscheme, </a>
<a class="sourceLine" id="cb186-25" data-line-number="25">              <span class="dt">legendText=</span>levs, </a>
<a class="sourceLine" id="cb186-26" data-line-number="26">              <span class="dt">legendColors=</span>mycols))</a>
<a class="sourceLine" id="cb186-27" data-line-number="27">}</a></code></pre></div>
<p>Here’s how you use it:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">bachelorPlus &lt;-<span class="st"> </span>mapData<span class="op">$</span>Bach_plus_prop</a>
<a class="sourceLine" id="cb187-2" data-line-number="2">myShapeColors &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb187-3" data-line-number="3"></a>
<a class="sourceLine" id="cb187-4" data-line-number="4"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb187-5" data-line-number="5">     <span class="dt">main =</span> <span class="st">&quot;Share of Adults with College Degree&quot;</span>, </a>
<a class="sourceLine" id="cb187-6" data-line-number="6">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb187-7" data-line-number="7"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb187-8" data-line-number="8">       <span class="dt">legend =</span> myShapeColors<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb187-9" data-line-number="9">       <span class="dt">fill =</span> myShapeColors<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, </a>
<a class="sourceLine" id="cb187-10" data-line-number="10">       <span class="dt">title =</span> <span class="st">&quot;College Prop&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-89-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Hallelujah, we finally have made an image of something. Notice that the output of the <code>getShapeColors</code> functions contains three elements (it is technically a list): values (colors values for each geographic area), legend (text for the legend, including the ranges of values), and palette (these are the colors that go into the len).</p>
<p>The input of <code>getShapeColors</code> is the data you want to visualize as well as the number of levels. In this example, we chose 5. By default, the color palette is shades of blue, but as it is writte, you can provide different colors if you like. For example, the Furman report used a color palette called viridis, which ranges from dark blue to yellow. The only modification necessary is to add an argument to the function:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">myShapeColors &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">mycolors=</span><span class="kw">viridis</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb188-2" data-line-number="2"></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb188-4" data-line-number="4">     <span class="dt">main =</span> <span class="st">&quot;Share of Adults with College Degree&quot;</span>, <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb188-6" data-line-number="6">       <span class="dt">legend =</span> myShapeColors<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb188-7" data-line-number="7">       <span class="dt">fill =</span> myShapeColors<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Prop&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-90-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>I don’t know exactly how ABCNews made their color palette, but here is my approximation. I played around with the border color and line width as well.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">ABCpalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gray88&quot;</span>, <span class="st">&quot;#4e9ccb&quot;</span>, <span class="st">&quot;#3b7ba9&quot;</span>,<span class="st">&quot;#265982&quot;</span>, <span class="st">&quot;#133960&quot;</span>,<span class="st">&quot;#001a3a&quot;</span>)</a>
<a class="sourceLine" id="cb189-2" data-line-number="2">myShapeColors &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">mycolors=</span>ABCpalette)</a>
<a class="sourceLine" id="cb189-3" data-line-number="3"></a>
<a class="sourceLine" id="cb189-4" data-line-number="4"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb189-5" data-line-number="5">     <span class="dt">main =</span> <span class="st">&quot;Share of Adults with College Degree&quot;</span>, </a>
<a class="sourceLine" id="cb189-6" data-line-number="6">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb189-7" data-line-number="7"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb189-8" data-line-number="8">       <span class="dt">legend =</span> myShapeColors<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb189-9" data-line-number="9">       <span class="dt">fill =</span> myShapeColors<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Share&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-91-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Here is the original again.</p>
<div class="figure" style="text-align: center"><span id="fig:abc-college"></span>
<img src="images/abc_CollegeDegreeNycZip_v02_KA_hpEmbed_17x12_992.jpg" alt="ABCNews visualization" width="80%" />
<p class="caption">
Figure 15.1: ABCNews visualization
</p>
</div>
<p>I hope you agree that it’s pretty close! Did you spot the main difference? Sure, there are a few of them, but notice the legend in the ABCNews figure? ABCNews used fixed ranges for their level cutoffs, whereas we were using quintiles! What if we want custom cut-points that are not quantiles?</p>
<p>I anticipated this desire in the getShapeColors function, so it’s easy enough. Instead of providing a number (e.g, 5) for <code>nbreaks</code>, you provide the actual list of cutpoints. Here it is on its own.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">ABCpalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gray88&quot;</span>, <span class="st">&quot;#4e9ccb&quot;</span>, <span class="st">&quot;#3b7ba9&quot;</span>,<span class="st">&quot;#265982&quot;</span>, <span class="st">&quot;#133960&quot;</span>,<span class="st">&quot;#001a3a&quot;</span>)</a>
<a class="sourceLine" id="cb190-2" data-line-number="2">myShapeColors &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb190-3" data-line-number="3">                                 <span class="dt">mycolors=</span>ABCpalette)</a>
<a class="sourceLine" id="cb190-4" data-line-number="4"></a>
<a class="sourceLine" id="cb190-5" data-line-number="5"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb190-6" data-line-number="6">     <span class="dt">main =</span> <span class="st">&quot;Share of Adults with College Degree&quot;</span>, </a>
<a class="sourceLine" id="cb190-7" data-line-number="7">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb190-8" data-line-number="8"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb190-9" data-line-number="9">       <span class="dt">legend =</span> myShapeColors<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb190-10" data-line-number="10">       <span class="dt">fill =</span> myShapeColors<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Share&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-92-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>And here are two versions of the same data, mapped side-by-side using different cut-points:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">ABCpalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gray88&quot;</span>, <span class="st">&quot;#4e9ccb&quot;</span>, <span class="st">&quot;#3b7ba9&quot;</span>,<span class="st">&quot;#265982&quot;</span>, <span class="st">&quot;#133960&quot;</span>,<span class="st">&quot;#001a3a&quot;</span>)</a>
<a class="sourceLine" id="cb191-2" data-line-number="2">myShapeColors1 &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb191-3" data-line-number="3">                                 <span class="dt">mycolors=</span>ABCpalette)</a>
<a class="sourceLine" id="cb191-4" data-line-number="4">myShapeColors2 &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb191-5" data-line-number="5">                                 <span class="dt">mycolors=</span>ABCpalette)</a>
<a class="sourceLine" id="cb191-6" data-line-number="6"></a>
<a class="sourceLine" id="cb191-7" data-line-number="7"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb191-8" data-line-number="8"></a>
<a class="sourceLine" id="cb191-9" data-line-number="9"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors1<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb191-10" data-line-number="10">     <span class="dt">main =</span> <span class="st">&quot;%College using Quintiles&quot;</span>, </a>
<a class="sourceLine" id="cb191-11" data-line-number="11">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb191-12" data-line-number="12"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb191-13" data-line-number="13">       <span class="dt">legend =</span> myShapeColors1<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb191-14" data-line-number="14">       <span class="dt">fill =</span> myShapeColors1<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Share&quot;</span>)</a>
<a class="sourceLine" id="cb191-15" data-line-number="15"></a>
<a class="sourceLine" id="cb191-16" data-line-number="16"></a>
<a class="sourceLine" id="cb191-17" data-line-number="17"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors2<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb191-18" data-line-number="18">     <span class="dt">main =</span> <span class="st">&quot;%College using Equal Intervals&quot;</span>, </a>
<a class="sourceLine" id="cb191-19" data-line-number="19">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb191-20" data-line-number="20"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb191-21" data-line-number="21">       <span class="dt">legend =</span> myShapeColors2<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb191-22" data-line-number="22">       <span class="dt">fill =</span> myShapeColors2<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Share&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-93-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>The difference may be subtle, and I believe an argument can be made for either. But all in all, I believe that the level separation by quintiles does a better job in highlighting the difference between the different parts of the city.</p>
<p>This brings us to our next topic, which is comparing COVID-19 incidence maps to maps showing census data (e.g., income, college education, race, etc.)</p>
</div>
<div id="looking-at-two-variables-at-the-same-time" class="section level4 unnumbered">
<h4>Looking at two variables at the same time</h4>
<p>We can borrow the same side-by-side technique as above, but instead of the same data with different cut-points, we can plot two different variables. We’ll use quintiles in both cases.</p>
<p>It turns out that population-adjusted COVID-19 rate is not actually in our data set. We need to make it, but it’s easy.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">covidPerCapita &lt;-<span class="st"> </span>mapData<span class="op">$</span>Positive<span class="op">/</span>mapData<span class="op">$</span>Total_Pop<span class="op">*</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb192-2" data-line-number="2"><span class="kw">hist</span>(covidPerCapita, <span class="dt">main=</span><span class="st">&quot;Zipcode-level Positive Cases Percent of Population&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-94-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1">myShapeColors1 &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(covidPerCapita, <span class="dt">nbreaks=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb193-2" data-line-number="2">myShapeColors2 &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb193-3" data-line-number="3"></a>
<a class="sourceLine" id="cb193-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb193-5" data-line-number="5"></a>
<a class="sourceLine" id="cb193-6" data-line-number="6"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors1<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb193-7" data-line-number="7">     <span class="dt">main =</span> <span class="st">&quot;%COVID Cases&quot;</span>, </a>
<a class="sourceLine" id="cb193-8" data-line-number="8">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb193-9" data-line-number="9"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb193-10" data-line-number="10">       <span class="dt">legend =</span> myShapeColors1<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb193-11" data-line-number="11">       <span class="dt">fill =</span> myShapeColors1<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;COVID rate&quot;</span>)</a>
<a class="sourceLine" id="cb193-12" data-line-number="12"></a>
<a class="sourceLine" id="cb193-13" data-line-number="13"></a>
<a class="sourceLine" id="cb193-14" data-line-number="14"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColors2<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb193-15" data-line-number="15">     <span class="dt">main =</span> <span class="st">&quot;%College&quot;</span>, </a>
<a class="sourceLine" id="cb193-16" data-line-number="16">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">border=</span><span class="st">&quot;white&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb193-17" data-line-number="17"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, </a>
<a class="sourceLine" id="cb193-18" data-line-number="18">       <span class="dt">legend =</span> myShapeColors2<span class="op">$</span>legendText, </a>
<a class="sourceLine" id="cb193-19" data-line-number="19">       <span class="dt">fill =</span> myShapeColors2<span class="op">$</span>legendColors, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">title =</span> <span class="st">&quot;College Share&quot;</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-95-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Now we’re looking at two different variables, both mapped using quintiles as an organizer of zipcode-level data. It definitely seems like one map is almost an inverse of the other. Where COVID rate is high, college rate is low, and vice versa. Is there some way for us to see both variables on the same map at the same time?</p>
<p>Here’s one idea. Suppose we used different colors for each variable, e.g. red and blue, but we used shades from lighter to darker to indicate lowr and higher values. And suppose we made the colors transparent, the way we did when we plotted two histograms on the same plot. When pink and light-blue are both laid over each other, we will see a purplish color. Therefore</p>
<ol style="list-style-type: decimal">
<li>If both variables are high, we will have darker purple</li>
<li>If both variables are low, we will have lighter purple</li>
<li>If one variable is high and the other low, we will see regions of red or blue</li>
</ol>
<p>So what happens if we “add” up the two variable maps this way?</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">myShapeColorsCovid &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(covidPerCapita, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">rdgrbl=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb194-2" data-line-number="2">myShapeColorsCollege &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(bachelorPlus, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">rdgrbl=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb194-3" data-line-number="3"></a>
<a class="sourceLine" id="cb194-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb194-5" data-line-number="5"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid&quot;</span>, </a>
<a class="sourceLine" id="cb194-6" data-line-number="6">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb194-7" data-line-number="7"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCollege<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;college&quot;</span>, </a>
<a class="sourceLine" id="cb194-8" data-line-number="8">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>) </a>
<a class="sourceLine" id="cb194-9" data-line-number="9"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid+college&quot;</span>, </a>
<a class="sourceLine" id="cb194-10" data-line-number="10">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb194-11" data-line-number="11"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCollege<span class="op">$</span>regionValues, <span class="dt">add=</span>T, </a>
<a class="sourceLine" id="cb194-12" data-line-number="12">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-96-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>In the case of college education and COVID incidence rates, the variables are negatively associated. Overlaying two color maps, we see red and bluish regions, but we also see some purple stuff.</p>
<p>What would happen if we did the same for two variable with positive association? Let us map COVID-19 incidence against the average household size.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1">myShapeColorsCovid &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(covidPerCapita, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">rdgrbl=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb195-2" data-line-number="2">myShapeColorsHH &lt;-<span class="st"> </span><span class="kw">getShapeColors</span>(mapData<span class="op">$</span>AvgHH, <span class="dt">nbreaks=</span><span class="dv">5</span>, <span class="dt">rdgrbl=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb195-3" data-line-number="3"></a>
<a class="sourceLine" id="cb195-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb195-5" data-line-number="5"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid&quot;</span>, </a>
<a class="sourceLine" id="cb195-6" data-line-number="6">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb195-7" data-line-number="7"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsHH<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;hh size&quot;</span>, </a>
<a class="sourceLine" id="cb195-8" data-line-number="8">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>) </a>
<a class="sourceLine" id="cb195-9" data-line-number="9"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid+hhsize&quot;</span>, </a>
<a class="sourceLine" id="cb195-10" data-line-number="10">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb195-11" data-line-number="11"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsHH<span class="op">$</span>regionValues, <span class="dt">add=</span>T, </a>
<a class="sourceLine" id="cb195-12" data-line-number="12">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-97-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Indeed, in this case, we see a map that is much more purplish overall.</p>
<p>Given the code examples above, you should be able to create your own zipcode maps of the variables in our data set. You can even get more variables using census queries. The problem of visualizing two (or more) variables on a map is still a challenge. The fact is, there are other data visualizations that are probably better suited to that task, even though they don’t have the narrative association with geography. I’m thinking about the lowly scatterplot</p>
</div>
</div>
<div id="scatterplots" class="section level3 unnumbered">
<h3>Scatterplots</h3>
<p>Here are the data from the last two examples visualized using both maps and scatterplots.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb196-2" data-line-number="2"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid+hhsize&quot;</span>, </a>
<a class="sourceLine" id="cb196-3" data-line-number="3">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb196-4" data-line-number="4"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsHH<span class="op">$</span>regionValues, <span class="dt">add=</span>T, </a>
<a class="sourceLine" id="cb196-5" data-line-number="5">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb196-6" data-line-number="6"></a>
<a class="sourceLine" id="cb196-7" data-line-number="7"><span class="kw">plot</span>(mapData<span class="op">$</span>AvgHH, covidPerCapita, <span class="dt">col=</span>myShapeColorsCovid<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb196-8" data-line-number="8">     <span class="dt">pch=</span><span class="dv">16</span>,</a>
<a class="sourceLine" id="cb196-9" data-line-number="9">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb196-10" data-line-number="10"><span class="kw">points</span>(mapData<span class="op">$</span>AvgHH, covidPerCapita, <span class="dt">col=</span>myShapeColorsHH<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb196-11" data-line-number="11">       <span class="dt">pch=</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb196-12" data-line-number="12"><span class="kw">mtext</span>(<span class="st">&quot;Avg Household Size&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb196-13" data-line-number="13"><span class="kw">mtext</span>(<span class="st">&quot;COVID rate&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb196-14" data-line-number="14"></a>
<a class="sourceLine" id="cb196-15" data-line-number="15"></a>
<a class="sourceLine" id="cb196-16" data-line-number="16"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCovid<span class="op">$</span>regionValues, <span class="dt">main =</span> <span class="st">&quot;covid+college&quot;</span>, </a>
<a class="sourceLine" id="cb196-17" data-line-number="17">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb196-18" data-line-number="18"><span class="kw">plot</span>(NYC_zips, <span class="dt">col =</span> myShapeColorsCollege<span class="op">$</span>regionValues, <span class="dt">add=</span>T, </a>
<a class="sourceLine" id="cb196-19" data-line-number="19">     <span class="dt">cex =</span> <span class="dv">10</span>, <span class="dt">lwd=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb196-20" data-line-number="20"></a>
<a class="sourceLine" id="cb196-21" data-line-number="21"><span class="kw">plot</span>(mapData<span class="op">$</span>Bach_plus_prop, covidPerCapita, <span class="dt">col=</span>myShapeColorsCovid<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb196-22" data-line-number="22">     <span class="dt">pch=</span><span class="dv">16</span>,</a>
<a class="sourceLine" id="cb196-23" data-line-number="23">     <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb196-24" data-line-number="24"><span class="kw">points</span>(mapData<span class="op">$</span>Bach_plus_prop, covidPerCapita, <span class="dt">col=</span>myShapeColorsCollege<span class="op">$</span>regionValues, </a>
<a class="sourceLine" id="cb196-25" data-line-number="25">       <span class="dt">pch=</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb196-26" data-line-number="26"><span class="kw">mtext</span>(<span class="st">&quot;College Percentage&quot;</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb196-27" data-line-number="27"><span class="kw">mtext</span>(<span class="st">&quot;COVID rate&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="Figs/unnamed-chunk-98-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>The scatterplots on the right side make it easier to see the relationship between the two variables. As average household sizes go up per zipcode, so do COVID rates. As college education goes up, COVID rates go down. Each point in the scatterplot corresponds to a zipcode region, and in fact, the coloring of the points is the same as the coloring of the regions. But the scatterplot has no geographical information.</p>
<p>Along the 1-to-1 line (i.e., a perfect positive and linear relationship), we would have all purple points, with the colors getting darker at high values. The farther away we are from this diagonal, the more red (above the line) or blue (below) the points are. Note that even with a strongly negative relationship (diagonal trend going down to the right), we will still pass through a purple region. These are regions with average values for both variables.</p>

</div>
</div>
<!-- </div> -->



<p style="text-align: center;">
<a href="15-4-zipcode.html"><button class="btn btn-default">Previous</button></a>
<a href="A-sec-randomness.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
